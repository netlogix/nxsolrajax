!function(e,t,r){"use strict";var a=t.module("nx.solrajax",["ngSanitize","ui.bootstrap.typeahead","nx.angular.variables"]);a.config(["$routeProvider","nxConfigurationServiceProvider",function(e,t){e.when("/ajaxsearch/:path*",{controller:"SearchResultCtrl",templateUrl:t.value("nx.solrajax.searchresult.templateUrl"),resolve:{searchResponse:["$location","$http",function(e,t){return t.get(e.path(),{params:e.search(),cache:!0})}]}})}]),a.controller("SearchResultCtrl",["searchResponse","$http","$location","$scope","$rootScope","dateFilter",function(e,r,a,n,s,c){function o(){n.results.prevLink&&r.get(n.results.prevLink,{cache:!0}),n.results.nextLink&&r.get(n.results.nextLink,{cache:!0})}n.showFacetFilters=!1,n.loading=!1,n.suggestLoading=!1,n.q=e.data.search.q||"",n.facets=e.data.facets,n.results=e.data.result,n.search=e.data.search,n.typeFacet=function(){return t.isUndefined(n.facets.availableFacets)?!1:n.facets.availableFacets.filter(function(e){return e.label?"type"===e.name.toLowerCase():!1})[0]},n.autoSuggestion=function(e){return r.get(n.search.suggestUrl,{params:{q:e.toLowerCase()},cache:!0}).then(function(e){return e.data.results})},n.submitSearch=function(e){var r=n.suggestLoading&&t.isDefined(e)?e.val():this.q.name||this.q;a.path(n.search.url.replace("QUERY_STRING",r))},n.removeSearch=function(){a.path(n.search.url.replace("QUERY_STRING",""))},n.select=function(e){a.path(e)},n.selectDate=function(e){var r,n,s;t.isObject(e.range)&&(e.start=e.range.start,e.end=e.range.end),r=e.start?c(e.start,"yyyyMMdd"):"*",n=e.end?c(e.end,"yyyyMMdd"):"*",s=e.start||e.end?decodeURI(e.url).replace(encodeURI("{filterValue}"),encodeURI(r+e.delimiter+n)):e.reseturl,a.path(s)},n.removeDate=function(e){e.start="",e.end="",e.range="",n.selectDate(e)},n.removeStartDate=function(e){e.start="",n.selectDate(e)},n.removeEndDate=function(e){e.end="",n.selectDate(e)},n.isDateSelected=function(){var e=!1;return t.forEach(n.facets.availableFacets,function(t){"queryGroup"!==t.type&&"dateRange"!==t.type||!t.active||(e=!0)}),e},n.loadPrev=function(){s.$broadcast("$solrajaxLoadMoreStart",n.results.prevLink),n.loading=!0,r.get(n.results.prevLink,{cache:!0}).success(function(e){s.$broadcast("$solrajaxLoadMoreSuccess",n.results.prevLink),n.results.prevLink=e.result.prevLink||"",t.forEach(e.result.resultDocuments.reverse(),function(e){n.results.resultDocuments.unshift(e)}),n.loading=!1,o()}).error(function(){s.$broadcast("$solrajaxLoadMoreError",n.results.prevLink),n.results.prevLink="",n.loading=!1})},n.loadNext=function(){s.$broadcast("$solrajaxLoadMoreStart",n.results.nextLink),n.loading=!0,r.get(n.results.nextLink,{cache:!0}).success(function(e){s.$broadcast("$solrajaxLoadMoreSuccess",n.results.nextLink),n.results.nextLink=e.result.nextLink||"",t.forEach(e.result.resultDocuments,function(e){n.results.resultDocuments.push(e)}),n.loading=!1,o()}).error(function(){s.$broadcast("$solrajaxLoadMoreError",n.results.nextLink),n.results.nextLink="",n.loading=!1})},n.isSiteActive=function(e){return n.search.site.selected===e},n.selectSite=function(e){t.isUndefined(n.search.site[e])||n.select(n.search.site[e])},o()}]),a.directive("nxBindResult",["$sce","$parse","$compile",function(e,t,r){return function(a,n,s){function c(){return(o(a)||"").toString()}n.addClass("ng-binding").data("$binding",s.nxBindResult);var o=t(s.nxBindResult);a.$watch(c,function i(){n.html(r(e.getTrustedHtml(e.trustAsHtml(o(a))))(a)||"")})}}])}(window,angular);
//# sourceMappingURL=./Solrajax.min.js.map