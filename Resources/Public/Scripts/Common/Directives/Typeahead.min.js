(function(e,t,n){"use strict";t.module("ui.bootstrap.typeahead",["ui.bootstrap.position","ui.bootstrap.bindHtml"]).factory("typeaheadParser",["$parse",function(e){var t=/^\s*(.*?)(?:\s+as\s+(.*?))?\s+for\s+(?:([\$\w][\$\w\d]*))\s+in\s+(.*)$/;return{parse:function(n){var r=n.match(t);if(!r)throw new Error('Expected typeahead specification in form of "_modelValue_ (as _label_)? for _item_ in _collection_" but got "'+n+'".');return{itemName:r[3],source:e(r[4]),viewMapper:e(r[2]||r[1]),modelMapper:e(r[1])}}}}]).directive("typeahead",["$compile","$parse","$q","$timeout","$document","$position","typeaheadParser",function(e,r,i,s,o,u,a){var f=[9,13,27,38,40];return{require:"ngModel",link:function(l,c,h,p){var d=l.$eval(h.typeaheadMinLength)||1,v=l.$eval(h.typeaheadWaitMs)||0,m=l.$eval(h.typeaheadEditable)!==!1,g=r(h.typeaheadLoading).assign||t.noop,y=r(h.typeaheadOnSelect),b=h.typeaheadInputFormatter?r(h.typeaheadInputFormatter):n,w=h.typeaheadAppendToBody?l.$eval(h.typeaheadAppendToBody):!0,E=r(h.ngModel).assign,S=a.parse(h.typeahead),x;c.attr({"aria-autocomplete":"list","aria-expanded":!1});var T=t.element("<div typeahead-popup></div>");T.attr({matches:"matches",active:"activeIdx",select:"select(activeIdx)",query:"query",position:"position"});t.isDefined(h.typeaheadTemplateUrl)&&T.attr("template-url",h.typeaheadTemplateUrl);var N=l.$new();l.$on("$destroy",function(){N.$destroy()});var C=function(){N.matches=[];N.activeIdx=-1;c.attr("aria-expanded",!1)},k=function(e){var t={$viewValue:e};g(l,!0);i.when(S.source(l,t)).then(function(n){var r=e===p.$viewValue;if(r&&x)if(n.length>0){N.activeIdx=0;N.matches.length=0;for(var i=0;i<n.length;i++){t[S.itemName]=n[i];N.matches.push({label:S.viewMapper(N,t),model:n[i]})}N.query=e;N.position=w?u.offset(c):u.position(c);N.position.top=N.position.top+c.prop("offsetHeight");c.attr("aria-expanded",!0)}else C();r&&g(l,!1)},function(){C();g(l,!1)})};C();N.query=n;var L;p.$parsers.unshift(function(e){x=!0;if(e&&e.length>=d)if(v>0){L&&s.cancel(L);L=s(function(){k(e)},v)}else k(e);else{g(l,!1);C()}if(m)return e;if(!e){p.$setValidity("editable",!0);return e}p.$setValidity("editable",!1);return n});p.$formatters.push(function(e){var t,r,i={};if(b){i.$model=e;return b(l,i)}i[S.itemName]=e;t=S.viewMapper(l,i);i[S.itemName]=n;r=S.viewMapper(l,i);return t!==r?t:e});N.select=function(e){var t={},n,r;t[S.itemName]=r=N.matches[e].model;n=S.modelMapper(l,t);E(l,n);p.$setValidity("editable",!0);y(l,{$item:r,$model:n,$label:S.viewMapper(l,t)});C();s(function(){c[0].focus()},0,!1)};c.bind("keydown",function(e){if(N.matches.length===0||f.indexOf(e.which)===-1)return;e.preventDefault();if(e.which===40){N.activeIdx=(N.activeIdx+1)%N.matches.length;N.$digest()}else if(e.which===38){N.activeIdx=(N.activeIdx?N.activeIdx:N.matches.length)-1;N.$digest()}else if(e.which===13||e.which===9)N.$apply(function(){N.select(N.activeIdx)});else if(e.which===27){e.stopPropagation();C();N.$digest()}});c.bind("blur",function(e){x=!1});var A=function(e){if(c[0]!==e.target){C();N.$digest()}};o.bind("click",A);l.$on("$destroy",function(){o.unbind("click",A)});var O=e(T)(N);w?o.find("body").append(O):c.after(O)}}}]).value("ui.bootstrap.typeahead.typeaheadPopup.templateUrl","typo3conf/ext/nxsolrajax/Resources/Public/Templates/Typeahead/TypeaheadPopup.html").directive("typeaheadPopup",["ui.bootstrap.typeahead.typeaheadPopup.templateUrl",function(e){return{restrict:"EA",scope:{matches:"=",query:"=",active:"=",position:"=",select:"&"},replace:!0,templateUrl:e,link:function(e,t,n){e.templateUrl=n.templateUrl;e.isOpen=function(){return e.matches.length>0};e.isActive=function(t){return e.active==t};e.selectActive=function(t){e.active=t};e.selectMatch=function(t){e.select({activeIdx:t})}}}}]).value("ui.bootstrap.typeahead.typeaheadMatch.templateUrl","typo3conf/ext/nxsolrajax/Resources/Public/Templates/Typeahead/TypeaheadMatch.html").directive("typeaheadMatch",["$http","$templateCache","$compile","$parse","ui.bootstrap.typeahead.typeaheadMatch.templateUrl",function(e,t,n,r,i){return{restrict:"EA",scope:{index:"=",match:"=",query:"="},link:function(s,o,u){var a=r(u.templateUrl)(s.$parent)||i;e.get(a,{cache:t}).success(function(e){o.replaceWith(n(e.trim())(s))})}}}]).filter("typeaheadHighlight",function(){function e(e){return e.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}return function(t,n){return n?(""+t).replace(new RegExp(e(n),"gi"),"<strong>$&</strong>"):t}})})(window,angular);